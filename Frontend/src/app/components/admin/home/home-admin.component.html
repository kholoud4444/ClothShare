<!-- home-admin.component.html -->
<div class="grid" dir="rtl">
  <!-- Sidebar -->
  <p-sidebar [(visible)]="sidebarVisible" [baseZIndex]="10000" styleClass="p-sidebar-md" [showCloseIcon]="false" [modal]="false">
    <h3 class="text-xl font-bold mb-4">لوحة التحكم</h3>
    <p-menu [model]="menuItems" styleClass="w-full border-none"></p-menu>
  </p-sidebar>

  <!-- Mobile Header -->
  <div class="col-12 flex lg:hidden justify-content-between align-items-center surface-0 border-bottom-1 border-300 p-3">
    <button pButton icon="pi pi-bars" (click)="sidebarVisible = true" class="p-button-text"></button>
    <h3 class="m-0">لوحة التحكم</h3>
  </div>

  <!-- Main Content -->
  <div class="col-12 lg:col-12 p-3">
    <div class="grid">
      <!-- Filter Section -->
      <div class="col-12">
        <p-card styleClass="mb-4">
          <div class="flex flex-column md:flex-row align-items-center gap-3">
            <!-- Remove the for attribute since p-dropdown doesn't need a label association -->
            <span class="font-bold">تصفية حسب الحالة:</span>
            <p-dropdown [options]="statusOptions"
                        [(ngModel)]="selectedStatus"
                        (onChange)="filterByStatus($event)"
                        placeholder="اختر الحالة"
                        styleClass="w-full md:w-20rem">
            </p-dropdown>
          </div>
        </p-card>
      </div>

      <!-- Table Section -->
      <div class="col-12">
        <p-card>
          <p-table [value]="items"
                   [paginator]="true"
                   [rows]="itemsPerPage"
                   [totalRecords]="totalItems"
                   [showCurrentPageReport]="true"
                   [tableStyle]="{'min-width': '50rem'}"
                   [loading]="loading"
                   styleClass="p-datatable-responsive-demo"
                   currentPageReportTemplate="عرض {first} الى {last} من {totalRecords} عنصر"
                   [rowsPerPageOptions]="[5,10,20]"
                   responsiveLayout="stack"
                   (onPage)="goToPage($event.first / itemsPerPage)">

            <ng-template pTemplate="header">
              <tr>
                <th>اسم المنتج</th>
                <th>اسم المتبرع</th>
                <th>الصورة</th>
                <th>الحالة</th>
                <th>الإجراءات</th>
              </tr>
            </ng-template>

            <ng-template pTemplate="body" let-item>
              <tr>
                <td>
                  <span class="p-column-title">اسم المنتج</span>
                  {{item.item.type}}
                </td>
                <td>
                  <span class="p-column-title">اسم المتبرع</span>
                  {{item.volunteerName}}
                </td>
                <td>
                  <span class="p-column-title">الصورة</span>
                  <p-image [src]="item.item.imageUrl"
                           alt="صورة المنتج"
                           width="100"
                           [preview]="true">
                  </p-image>
                </td>
                <td>
                  <span class="p-column-title">الحالة</span>
                  <p-tag [severity]="getStatusSeverity(item.item.status)"
                         [value]="item.item.status">
                  </p-tag>
                </td>
                <td>
                  <span class="p-column-title">الإجراءات</span>
                  <div class="flex gap-2">
                    <button pButton
                            icon="pi pi-check"
                            class="p-button-success p-button-rounded"
                            (click)="changeItemRequest(item, 'تم_الموافقه')"
                            [disabled]="item.item.status === 'تم_الموافقه'"
                            pTooltip="موافقة">
                    </button>
                    <button pButton
                            icon="pi pi-times"
                            class="p-button-danger p-button-rounded"
                            (click)="changeItemRequest(item, 'مرفوض')"
                            [disabled]="item.item.status === 'مرفوض'"
                            pTooltip="رفض">
                    </button>
                  </div>
                </td>
              </tr>
            </ng-template>

            <ng-template pTemplate="emptymessage">
              <tr>
                <td colspan="5" class="text-center">
                  <p-message severity="info" text="لا توجد بيانات للعرض" styleClass="w-full"></p-message>
                </td>
              </tr>
            </ng-template>
          </p-table>
        </p-card>
      </div>
    </div>
  </div>
</div>
